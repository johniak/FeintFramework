<!DOCTYPE html>
<html>
<head>    
	<meta charset="utf-8">
    <title>Feint Admin- Model {{model}}</title>
<link href="/static/css/fuelux.css" rel="stylesheet" />
<link href="/static/css/fuelux-responsive.css" rel="stylesheet" /> 
   <link href="/static/css/bootstrap.css" rel="stylesheet">
    <link href="/static/css/style.css" rel="stylesheet">
    <link href="/static/css/datepicker.css" rel="stylesheet">
    <link href="/static//css/bootstrap-responsive.css" rel="stylesheet">
    <style type="text/css">
        body {
            padding-top: 60px;
            padding-bottom: 40px;
        }
        .sidebar-nav {
            padding: 9px 0;
        }
        form {
        max-width: 300px;
        padding: 19px 29px 29px;
        margin: 0 auto 20px;
        background-color: #fff;
        border: 1px solid #e5e5e5;
        -webkit-border-radius: 5px;
           -moz-border-radius: 5px;
                border-radius: 5px;
        -webkit-box-shadow: 0 1px 2px rgba(0,0,0,.05);
           -moz-box-shadow: 0 1px 2px rgba(0,0,0,.05);
                box-shadow: 0 1px 2px rgba(0,0,0,.05);
      }
      form .form-signin-heading,
      form .checkbox {
        margin-bottom: 10px;
      }
      form input[type="text"],
      form input[type="password"] {
        font-size: 16px;
        height: auto;
        margin-bottom: 15px;
        padding: 7px 9px;
      }
    </style>
</head>
<body>
	<div class="navbar navbar-fixed-top navbar-inverse">
    <div class="navbar-inner">
        <div class="container-fluid">
            <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="brand" href="/admin/">Feint Admin Panel</a>
            <div class="nav-collapse collapse">
            </div><!--/.nav-collapse -->
        </div>
    </div>
</div>

    <div class="container">
    	<div class="row">
		<div class="span12 columns">

    	<div style="height:400px;width:100%;margin-bottom:20px;">
<div class="fuelux datagrid-example">
				<div style="height:400px;width:100%;margin-bottom:20px;">
					<table id="MyGrid" class="table table-bordered datagrid">

						<thead>
						<tr>
							<th>
								<span class="datagrid-header-title">{{model}} Data</span>

								<div class="datagrid-header-left">
									<div class="input-append search datagrid-search">
										<input type="text" class="input-medium" placeholder="Search">
										<button type="button" class="btn"><i class="icon-search"></i></button>
									</div>
								</div>
								<div class="datagrid-header-right">
									<div class="select filter" >
										<button type="button" data-toggle="dropdown" class="btn dropdown-toggle">
											<span class="dropdown-label" style="width: 110px;"></span>
											<span class="caret"></span>
										</button>
										<ul class="dropdown-menu">
											<li data-value="all" data-selected="true"><a href="#">All</a></li>
											<li data-value="lt5m"><a href="#">Population &lt; 5M</a></li>
											<li data-value="gte5m"><a href="#">Population &gt;= 5M</a></li>
										</ul>
									</div>
								</div>
							</th>
						</tr>
						</thead>

						<tfoot>
						<tr>
							<th>
								<div class="datagrid-footer-left" style="display:none;">
									<div class="grid-controls">
										<span>
											<span class="grid-start"></span> -
											<span class="grid-end"></span> of
											<span class="grid-count"></span>
										</span>
										<div class="select grid-pagesize" >
											<button type="button" data-toggle="dropdown" class="btn dropdown-toggle">
												<span class="dropdown-label"></span>
												<span class="caret"></span>
											</button>
											<ul class="dropdown-menu">
												<li data-value="5"><a href="#">5</a></li>
												<li data-value="10" data-selected="true"><a href="#">10</a></li>
												<li data-value="20"><a href="#">20</a></li>
												<li data-value="50"><a href="#">50</a></li>
												<li data-value="100"><a href="#">100</a></li>
											</ul>
										</div>
										<span>Per Page</span>
									</div>
								</div>
								<div class="datagrid-footer-right" style="display:none;">
									<div class="grid-pager">
										<button type="button" class="btn grid-prevpage"><i class="icon-chevron-left"></i></button>
										<span>Page</span>

										<div class="input-append dropdown combobox">
											<input class="span1" type="text">
											<button type="button" class="btn" data-toggle="dropdown"><i class="caret"></i></button>
											<ul class="dropdown-menu"></ul>
										</div>
										<span>of <span class="grid-pages"></span></span>
										<button type="button" class="btn grid-nextpage"><i class="icon-chevron-right"></i></button>
									</div>
								</div>
							</th>
						</tr>
						</tfoot>

					</table>
				</div>
			</div>
			</div>
			</div>
			
			</div>
				    <script src="/static/js/lib/jquery.js"></script>
<script src="/static/js/lib/underscore.min.js"></script>
<script src="/static/js/lib/bootstrap.min.js"></script>
<script src="/static/loader.min.js" type="text/javascript"></script>
<script  type="text/javascript">
(function(root, factory) {
    if (typeof define === 'function' && define.amd) {
		define([ 'underscore' ], factory);
	} else {
		root.NestedAjaxDataSource = factory();
	}
}(this, function() {
 
	var NestedAjaxDataSource = function(options) {
		this._formatter = options.formatter;
		this._columns = options.columns;
		this._delay = options.delay || 0;
		this._pageIndex = options.pageIndex || 0;
		this._pageSize = options.pageSize || 10;
        this._data = options.data;
        //AJAXification by @btaylordesign
        this._data_url = options.data_url;
        this._data_key = options.data_key;
        this._initial_load_from_server = options.initial_load_from_server || false;
        this._always_load_from_server = options.always_load_from_server || false;
        this.reload_data_from_server = false;
	};
 
	NestedAjaxDataSource.prototype = {
 
		columns : function() {
			return this._columns;
		},
 
		data : function(options, callback) {
			var self = this;
 
			setTimeout(function() {
				 var data = $.extend(true, [], self._data),
                 count = data.length;
                
                 if (self.reload_data_from_server || self._initial_load_from_server || self._always_load_from_server)
                 {
                     $.ajax(self._data_url, {
                         dataType: 'json',
                         async: false,
                         type: 'GET'
                     }).done(function(json) {
                         data = self._data_key ? json[self._data_key] : json;
                         count = data.length;
                     });
 
                     self.reload_data_from_server = false;
                 }
 
				//FLATTENING by @JoeHetfield		        
		        $.each(self._columns, function(index, column) {
		            var pros = column.property.split('.');		 
		            if (pros.length > 1) {		 
		                $.each(data, function(index, row) {		 
		                    var tick = 1;
		                    var result = row[pros[0]];
		                    while (result && tick < pros.length) {
		                        result = result[pros[tick]];
		                        tick++;
		                    }
		                    row[column.property] = result;
		                });
		            }
		        });
		        
				// SEARCHING
				if (options.search) {
					data = _.filter(data, function(item) {
						var match = false;
 
						_.each(item, function(prop) {
							if (_.isString(prop) || _.isFinite(prop)) {
								if (prop.toString().toLowerCase().indexOf(
										options.search.toLowerCase()) !== -1)
									match = true;
							}
						});
 
						return match;
					});
				}
 
				// SORTING
				if (options.sortProperty) {
					data = _.sortBy(data, options.sortProperty);
					if (options.sortDirection === 'desc')
						data.reverse();
				}
 
				// PAGING
				var startIndex = self._pageIndex * self._pageSize;
				var endIndex = startIndex + self._pageSize;
				var end = (endIndex > count) ? count : endIndex;
				var pages = Math.ceil(count / self._pageSize);
				var page = self._pageIndex + 1;
				var start = startIndex + 1;
 
				data = data.slice(startIndex, endIndex);
 
				if (self._formatter)
					self._formatter(data);
 
				callback({
					data : data,
					start : start,
					end : end,
					count : count,
					pages : pages,
					page : page
				});
 
			}, this._delay)
		}
	};
 
	return NestedAjaxDataSource;
}));
$(function () {

	var dataSource = new NestedAjaxDataSource({
        data_url : '/admin/model/{{model}}/json/',
		initial_load_from_server: true,
		columns : [
		{%for collumn in collumns %}
		 {
			property : '{{collumn}}',
			label : '{{collumn}}',
			sortable : true
		},
		{% endfor %}],
		delay : 250
	});

		$('#MyGrid').datagrid({
			dataSource: dataSource,
			stretchHeight: true
		});
});
</script>
				</body>
</html>