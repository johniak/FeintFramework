<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Feint Admin- Model {{model}}</title>
    <link href="/static/css/fuelux.css" rel="stylesheet"/>
    <link href="/static/css/fuelux-responsive.css" rel="stylesheet"/>
    <link href="/static/css/bootstrap.css" rel="stylesheet">
    <link href="/static/css/style.css" rel="stylesheet">
    <link href="/static/css/datepicker.css" rel="stylesheet">
    <link href="/static/css/bootstrap-responsive.css" rel="stylesheet">
    <link href="/static/css/bootstrap-datetimepicker.min.css" rel="stylesheet">
    <style type="text/css">
        body {
            padding-top: 60px;
            padding-bottom: 40px;
        }

        .sidebar-nav {
            padding: 9px 0;
        }

        form {
            max-width: 300px;
            padding: 19px 29px 29px;
            margin: 0 auto 20px;
            background-color: #fff;
            border: 1px solid #e5e5e5;
            -webkit-border-radius: 5px;
            -moz-border-radius: 5px;
            border-radius: 5px;
            -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, .05);
            -moz-box-shadow: 0 1px 2px rgba(0, 0, 0, .05);
            box-shadow: 0 1px 2px rgba(0, 0, 0, .05);
        }

        form .form-signin-heading,
        form .checkbox {
            margin-bottom: 10px;
        }

        form input[type="text"],
        form input[type="password"] {
            font-size: 16px;
            height: auto;
            margin-bottom: 15px;
        /*    padding: 7px 9px;*/
        }
    </style>
</head>
<body>

<div class="navbar navbar-fixed-top navbar-inverse">
    <div class="navbar-inner">
        <div class="container-fluid">
            <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="brand" href="/admin/">Feint Admin Panel</a>

            <div class="nav-collapse collapse">
            </div>
            <!--/.nav-collapse -->
        </div>
    </div>
</div>

<div class="container">
    <div class="row">


        <div class="span12 columns">

            <div style="height:600px;width:100%;margin-bottom:20px;">
                <div class="fuelux datagrid-example">
                    <div style="height:400px;width:100%;margin-bottom:20px;">
                        <table id="MyGrid" class="table table-bordered datagrid">

                            <thead>
                            <tr>
                                <th>
                                    <span class="datagrid-header-title">{{model}} Data</span>

                                    <div class="datagrid-header-left">
                                        <div class="input-append search datagrid-search">
                                            <input type="text" class="input-medium" placeholder="Search">
                                            <button type="button" class="btn"><i class="icon-search"></i></button>
                                        </div>
                                    </div>
                                    <div class="datagrid-header-right">
                                        <button id="add-row" class="btn btn-success">Add</button>
                                    </div>
                                </th>
                            </tr>
                            </thead>

                            <tfoot>
                            <tr>
                                <th>
                                    <div class="datagrid-footer-left" style="display:none;">
                                        <div class="grid-controls">
										<span>
											<span class="grid-start"></span> -
											<span class="grid-end"></span> of
											<span class="grid-count"></span>
										</span>

                                            <div class="select grid-pagesize">
                                                <button type="button" data-toggle="dropdown"
                                                        class="btn dropdown-toggle">
                                                    <span class="dropdown-label"></span>
                                                    <span class="caret"></span>
                                                </button>
                                                <ul class="dropdown-menu">
                                                    <li data-value="5"><a href="#">5</a></li>
                                                    <li data-value="10" data-selected="true"><a href="#">10</a></li>
                                                    <li data-value="20"><a href="#">20</a></li>
                                                    <li data-value="50"><a href="#">50</a></li>
                                                    <li data-value="100"><a href="#">100</a></li>
                                                </ul>
                                            </div>
                                            <span>Per Page</span>
                                        </div>
                                    </div>
                                    <div class="datagrid-footer-right" style="display:none;">
                                        <div class="grid-pager">
                                            <button type="button" class="btn grid-prevpage"><i
                                                    class="icon-chevron-left"></i></button>
                                            <span>Page</span>

                                            <div class="input-append dropdown combobox">
                                                <input class="span1" type="text">
                                                <button type="button" class="btn" data-toggle="dropdown"><i
                                                        class="caret"></i></button>
                                                <ul class="dropdown-menu"></ul>
                                            </div>
                                            <span>of <span class="grid-pages"></span></span>
                                            <button type="button" class="btn grid-nextpage"><i
                                                    class="icon-chevron-right"></i></button>
                                        </div>
                                    </div>
                                </th>
                            </tr>
                            </tfoot>

                        </table>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
<div id="edit-modal" class="modal hide fade">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3>Edit</h3>
    </div>
    <div class="modal-body">
        <form id="edit-form">
            <table>
                {%for f in form%}
                {{f}}
                {%endfor%}
            </table>
        </form>
    </div>
    <div class="modal-footer">
        <a href="#" data-dismiss="modal" class="btn">Close</a>
        <a href="#" id="confirm-edit"  class="btn btn-primary">Save changes</a>
    </div>
</div>

<div id="delete-modal" class="modal hide fade">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3>Do you want to delete row?</h3>
    </div>
    <div class="modal-body">

    </div>
    <div class="modal-footer">
        <a href="#" data-dismiss="modal" class="btn">Cancel</a>
        <a href="#" id="confirm-delete" class="btn btn-danger">Delete Row</a>
    </div>
</div>

<div id="add-modal" class="modal hide fade">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3>Add new row</h3>
    </div>
    <div class="modal-body">
        <form id="add-form">
        <table>
                {%for f in form%}
                {{f}}
                {%endfor%}
        </table>
        </form>
    </div>
    <div class="modal-footer">
        <a href="#" data-dismiss="modal" class="btn">Cancel</a>
        <a href="#" id="confirm-add" class="btn btn-primary">Add Row</a>
    </div>
</div>


<script src="/static/js/lib/jquery.js"></script>
<script src="/static/js/lib/underscore.min.js"></script>
<script src="/static/js/lib/bootstrap.js"></script>
<script src="/static/js/lib/bootstrap-dropdown.js"></script>
<script src="/static/js/admin.js"></script>
<script src="/static/loader.min.js" type="text/javascript"></script>
<script src="/static/js/bootstrap-datetimepicker.min.js" type="text/javascript"></script>
<script  type="text/javascript">
    var id=-1;
    var grid;
    var model='{{model}}';

    $(function () {

        var dataSource = new NestedAjaxDataSource({
            data_url : '/admin/model/{{model}}/json/',
            initial_load_from_server: true,
            columns : [
                    {%for collumn in collumns %}
        {
            property : '{{collumn}}',
                    label : '{{collumn}}',
                sortable : true,
        },
        {% endfor %}
        {
            property: 'Editable'   ,
                    label:'Editable',
                sortable:false,

        }
        ],
        delay : 0,
                formatter: function (items) {
            $.each(items, function (index, item) {
                for(var p in item){
                    if(item[p].hasOwnProperty("Representative"))
                        item[p]=item[p].Representative;
                }

                item.Editable = '<div style=" float: right;" class="btn-group"><a  data-id='+item.Id+' class="edit-btn btn btn-info">Edit</a><a id="deleteGroup"  data-id='+item.Id+' class="delete-btn btn btn-danger">Delete</a></div>';
            });
        }

    });
    $('#confirm-delete').click(function(){
        deleteRow();
    });
    $('#confirm-add').click(function(){
        addRow();
    });
    $('#confirm-edit').click(function(){
        editRow();
    });

    $('.datetime').datetimepicker({
        language: 'en-US'
    });
    grid= $('#MyGrid').datagrid({
        dataSource: dataSource,
        stretchHeight: true
    });
    grid.on('loaded', function() {
        $(".delete-btn").click(function(){
            id=$(this).attr("data-id");
            $('#delete-modal').modal('show');
        });
        $(".edit-btn").click(function(){
            id=$(this).attr("data-id");
            $.ajax('/admin/model/'+model+'/'+id+'/', {
                dataType: 'json',
                async: false,
                type: 'GET'
            }).done(function (json) {
                      for(var p in json){
                          if(json[p].hasOwnProperty("Representative"))
                              $("input[name='"+p+"']").attr('value',json[p].Id);
                          else
                            $("input[name='"+p+"']").attr('value',json[p]);
                      }
             });
            $('#edit-modal').modal('show');
        });
    });
    $('#add-row').click(function(){
        $('#add-form input').val("");
        $('#add-modal').modal('show');
    }) ;

    });
</script>

</body>
</html>